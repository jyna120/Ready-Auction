<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
 <style>
  .image {
   text-align: center;
  }
  .image img {
   width: 220px;
   height: 220px;
   border-radius:50%;
   margin-bottom: 5%;
  }
   .blue {
    color: blue;
   }
  .red {
   color: red;
  }
 </style>
</head>

<body>
<div layout:fragment="content1">
 <div class="breadcrumb breadcrumb-style-one mb-0 ">
  <div class="container">
   <div class="col-lg-12 text-center">
    <h1 class="breadcrumb-title">마이페이지</h1>
    <ul class="d-flex justify-content-center breadcrumb-items">
     <li class="breadcrumb-item"><i class="bi bi-house-door"></i> <a th:href="@{/}">Home</a></li>
     <li class="breadcrumb-item active">마이페이지</li>
    </ul>
   </div>
  </div>
 </div>

 <div class="privacy-policy-wrapper mt-110">
  <div class="container">
   <div class="row">
    <div class="col-lg-4">

     <div class="pp-buttons-wrap">
      <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
       <button class="nav-link active" id="v-btn-pp1" data-bs-toggle="pill" data-bs-target="#v-pills-pp1" type="button" role="tab" aria-controls="v-pills-pp1" aria-selected="true">내 프로필 </button>
<!--       <button class="nav-link" id="v-btn-pp3" data-bs-toggle="pill" data-bs-target="#v-pills-pp3" type="button" role="tab" aria-controls="v-pills-pp3" aria-selected="false">계정</button>-->
       <button class="nav-link" id="v-btn-pp4" data-bs-toggle="pill" data-bs-target="#v-pills-pp4" type="button" role="tab" aria-controls="v-pills-pp4" aria-selected="false">경매 참여 내역</button>
       <button class="nav-link" id="v-btn-pp5" data-bs-toggle="pill" data-bs-target="#v-pills-pp5" type="button" role="tab" aria-controls="v-pills-pp5" aria-selected="false">경매 등록 내역</button>
       <button class="nav-link" id="v-btn-pp6" data-bs-toggle="pill" data-bs-target="#v-pills-pp6" type="button" role="tab" aria-controls="v-pills-pp6" aria-selected="false">1:1 문의 내역</button>
      </div>
     </div>
    </div>

    <div class="col-lg-8 pt-5 pt-lg-0">
     <div class="tab-content pp-tab-contents" id="v-pills-tabContent">

      <!-- 내 프로필 -->
      <div class="tab-pane fade show active pp-tab-body" id="v-pills-pp1" role="tabpanel" aria-labelledby="v-btn-pp1">
         <div class="container">
          <div class="image">
           <img id="profilePicture" th:src="${profileDto.profilePicture != null ? profileDto.profilePicture : 'assets/images/profile/basic-profile.png'}" alt="Profile Image">
          </div>
          <div class="single-widget">
           <h5 class="wdget-title">My Profile</h5>
           <ul class="widget-list">
            <li><span>닉네임 :</span><span th:text="${profileDto.nickname}"></span></li>
            <li><span>내 동네 :</span><span th:text="${profileDto.address}"></span></li>
            <li><span>매너지수 :</span><span th:text="${profileDto.mannerScore}"></span></li>
            <li>
             <span>좋아요 :</span>
             <ul>
              <li th:each="entry : ${profileDto.likeCounts}">
               <span th:text="${entry.key}">항목명</span>:
               <span th:text="${entry.value}">0</span>개
              </li>
             </ul>
            </li>

            <li>
             <span>싫어요 :</span>
             <ul>
              <li th:each="entry : ${profileDto.dislikeCounts}">
               <span th:text="${entry.key}">항목명</span>:
               <span th:text="${entry.value}">0</span>개
              </li>
             </ul>
            </li>
           </ul>
           <div style="text-align: right">
            <a th:href="@{/mypage/profile/update}" class="alpha-btn-md-dark">Edit</a>
           </div>
          </div>
         </div>
      </div>


      <!-- 계정 -->
<!--      <div class="tab-pane fade" id="v-pills-pp3" role="tabpanel" aria-labelledby="v-btn-pp3">-->
<!--       <div class="tab-inner-contentbox mt-0">-->
<!--        <h5 class="pp-title pt-0">Introduction</h5>-->
<!--        <p> </p>-->
<!--        <h5 class="pp-title">Definition of personal data</h5>-->
<!--        <p></p>-->
<!--        <ul class="pp-list">-->
<!--         <li></li>-->
<!--         <li></li>-->
<!--         <li></li>-->
<!--        </ul>-->
<!--        <h5 class="pp-title">Cookies and Similar Technologies</h5>-->
<!--        <p></p>-->
<!--        <h6 class="highlighted-text">You can remove or reject cookies using your browser or device settings, but in some cases doing so may affect your ability to use our products and services.</h6>-->
<!--        <ul class="pp-list">-->
<!--         <li></li>-->
<!--         <li></li>-->
<!--        </ul>-->
<!--        <h5 class="pp-title">Your Rights</h5>-->
<!--        <p></p>-->
<!--       </div>-->
<!--       <div class="tab-inner-contentbox">-->
<!--        <h5 class="pp-title pt-0">How you can contact us</h5>-->
<!--        <p></p>-->
<!--       </div>-->
<!--       <div class="tab-inner-contentbox">-->
<!--        <h5 class="pp-title pt-0">Additional Information</h5>-->
<!--        <p></p>-->
<!--       </div>-->
<!--      </div>-->


      <!-- 경매 참여 내역 -->
      <div class="tab-pane fade" id="v-pills-pp4" role="tabpanel" aria-labelledby="v-btn-pp4">
       <div class="tab-inner-contentbox mt-0">
        <h5 class="wdget-title">경매 참여 내역</h5>

        <!-- 경매 참여 내역 조회 -->
        <div class="item-describe-area">
         <ul class="nav nav-pills d-flex justify-content-center gap-sm-4 gap-1" id="pills-tab2" role="tablist">
          <li class="nav-item" role="presentation">
           <button class="nav-link active describe-btn" id="pills-home-tab2" data-bs-toggle="pill" data-bs-target="#pills-home2" type="button" role="tab" aria-controls="pills-home2" aria-selected="true">입찰 중</button>
          </li>
          <li class="nav-item" role="presentation">
           <button class="nav-link describe-btn" id="pills-profile-tab2" data-bs-toggle="pill" data-bs-target="#pills-profile2" type="button" role="tab" aria-controls="pills-profile2" aria-selected="false">낙찰</button>
          </li>
          <li class="nav-item" role="presentation">
           <button class="nav-link describe-btn" id="pills-contact-tab2" data-bs-toggle="pill" data-bs-target="#pills-contact2" type="button" role="tab" aria-controls="pills-contact2" aria-selected="false">패찰</button>
          </li>
         </ul>

         <!-- 입찰 중인 내역 -->
         <div class="tab-content" id="pills-tabContent2">
          <div class="tab-pane fade show active" id="pills-home2" role="tabpanel" aria-labelledby="pills-home-tab2">
           <div class="describe-content">
            <table class="table table-striped">
             <thead class="table-dark">
              <tr>
               <th scope="col">상품명</th>
               <th scope="col">나의 입찰가</th>
               <th scope="col">현재 입찰가</th>
               <th scope="col">시작일</th>
               <th scope="col">마감일</th>
              </tr>
             </thead>
             <tbody>
              <tr th:each="bid : ${biddingBids}">
               <td>
                <a th:href="@{/auction/product/{productId}(productId=${bid.product.id})}" th:text="${bid.product.name}"></a>
               </td>
               <td class="price" th:text="${bid.myPrice}"></td>
               <td class="price" th:text="${bid.product.currentPrice}"></td>
               <td th:text="${#dates.format(bid.product.startTime, 'yyyy년 M월 d일')}"></td>
               <td th:text="${#dates.format(bid.product.endTime, 'yyyy년 M월 d일')}"></td>
              </tr>
             </tbody>
            </table>
           </div>
          </div>

          <!-- 낙찰 내역 -->
          <div class="tab-pane fade" id="pills-profile2" role="tabpanel" aria-labelledby="pills-profile-tab2">
           <div class="describe-content">
            <table class="table table-striped">
             <thead class="table-dark">
             <tr>
              <th scope="col">상품명</th>
              <th scope="col">나의 입찰가</th>
              <th scope="col">시작일</th>
              <th scope="col">마감일</th>
              <th scope="col">결제</th>
             </tr>
             </thead>
             <tbody>
             <tr th:each="product : ${winningBids}">
              <td>
               <a th:href="@{/auction/bid-product/{productId}(productId=${product.id})}" th:text="${product.name}"></a>
              </td>
              <td class="price" th:text="${product.winner.price}"></td>
              <td th:text="${#dates.format(product.startTime, 'yyyy년 M월 d일')}"></td>
              <td th:text="${#dates.format(product.endTime, 'yyyy년 M월 d일')}"></td>
              <td>
               <a th:if="${isWinnerConfirmedMap[product.id]}"
                  th:href="@{/cash/payment/{productId}(productId=${product.id})}"
                  class="btn btn-primary">
                결제
               </a>
               <span th:unless="${isWinnerConfirmedMap[product.id]}" class="btn btn-secondary">
                결제 완료
               </span>
              </td>
             </tr>
             </tbody>
            </table>
           </div>
          </div>

          <!-- 패찰 내역 -->
          <div class="tab-pane fade" id="pills-contact2" role="tabpanel" aria-labelledby="pills-contact-tab2">
           <div class="describe-content">
            <table class="table table-striped">
             <thead class="table-dark">
             <tr>
              <th scope="col">상품명</th>
              <th scope="col">나의 입찰가</th>
              <th scope="col">현재 입찰가</th>
              <th scope="col">시작일</th>
              <th scope="col">마감일</th>
             </tr>
             </thead>
             <tbody>
             <tr th:each="bid : ${losingBids}">
              <td>
               <a th:href="@{/auction/bid-product/{productId}(productId=${bid.product.id})}" th:text="${bid.product.name}"></a>
              </td>
              <td class="price" th:text="${bid.myPrice}"></td>
              <td class="price" th:text="${bid.product.currentPrice}"></td>
              <td th:text="${#dates.format(bid.product.startTime, 'yyyy년 M월 d일')}"></td>
              <td th:text="${#dates.format(bid.product.endTime, 'yyyy년 M월 d일')}"></td>
             </tr>
             </tbody>
            </table>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>


      <!-- 경매 등록 내역 -->
      <div class="tab-pane fade" id="v-pills-pp5" role="tabpanel" aria-labelledby="v-btn-pp5">
       <div class="tab-inner-contentbox mt-0">
        <h5 class="wdget-title">경매 등록 내역</h5>

        <!-- 경매 등록 내역 조회 -->
        <div class="item-describe-area">
         <ul class="nav nav-pills d-flex justify-content-center gap-sm-4 gap-1" id="pills-tab3" role="tablist">
          <li class="nav-item" role="presentation">
           <button class="nav-link active describe-btn" id="pills-home-tab3" data-bs-toggle="pill" data-bs-target="#pills-home3" type="button" role="tab" aria-controls="pills-home3" aria-selected="true">판매 중</button>
          </li>
          <li class="nav-item" role="presentation">
           <button class="nav-link describe-btn" id="pills-profile-tab3" data-bs-toggle="pill" data-bs-target="#pills-profile3" type="button" role="tab" aria-controls="pills-profile3" aria-selected="false">거래 완료</button>
          </li>
          <li class="nav-item" role="presentation">
           <button class="nav-link describe-btn" id="pills-contact-tab3" data-bs-toggle="pill" data-bs-target="#pills-contact3" type="button" role="tab" aria-controls="pills-contact3" aria-selected="false">유찰</button>
          </li>
         </ul>

         <!-- 판매 중 내역 -->
         <div class="tab-content" id="pills-tabContent3">
          <div class="tab-pane fade show active" id="pills-home3" role="tabpanel" aria-labelledby="pills-home-tab3">
           <div class="describe-content">
            <table class="table table-striped">
             <thead class="table-dark">
             <tr>
              <th scope="col">상품명</th>
              <th scope="col">시작가</th>
              <th scope="col">현재 입찰가</th>
              <th scope="col">즉시 구매가</th>
              <th scope="col">시작일</th>
              <th scope="col">마감일</th>
             </tr>
             </thead>
             <tbody>
             <tr th:each="product : ${activeProducts}">
              <td>
               <a th:href="@{/auction/bid-product/{productId}(productId=${product.id})}" th:text="${product.name}"></a>
              </td>
              <td class="price" th:text="${product.startPrice}"></td>
              <td class="price" th:text="${product.currentPrice}"></td>
              <td class="price" th:text="${product.immediatePrice}"></td>
              <td th:text="${#dates.format(product.startTime, 'yyyy년 M월 d일')}"></td>
              <td th:text="${#dates.format(product.endTime, 'yyyy년 M월 d일')}"></td>
             </tr>
             </tbody>
            </table>
           </div>
          </div>

          <!-- 거래 완료 내역 -->
          <div class="tab-pane fade" id="pills-profile3" role="tabpanel" aria-labelledby="pills-profile-tab3">
           <div class="describe-content">
            <table class="table table-striped">
             <thead class="table-dark">
             <tr>
             <tr>
              <th scope="col">구분</th>
              <th scope="col">상품명</th>
              <th scope="col">시작가</th>
              <th scope="col">현재 입찰가</th>
              <th scope="col">즉시 구매가</th>
              <th scope="col">시작일</th>
              <th scope="col">마감일</th>
             </tr>
             </thead>
             <tbody>
             <tr th:each="product : ${completedProducts}">
              <td>
               <span th:text="${product.winner.status == 'CONFIRMED' ? '결제완료' : '구매확정'}"></span>
              </td>
              <td>
               <a th:href="@{/auction/bid-product/{productId}(productId=${product.id})}" th:text="${product.name}"></a>
              </td>
              <td class="price" th:text="${product.startPrice}"></td>
              <td class="price" th:text="${product.currentPrice}"></td>
              <td class="price" th:text="${product.immediatePrice}"></td>
              <td th:text="${#dates.format(product.startTime, 'yyyy년 M월 d일')}"></td>
              <td th:text="${#dates.format(product.endTime, 'yyyy년 M월 d일')}"></td>
             </tr>
             </tbody>
            </table>
           </div>
          </div>

          <!-- 유찰 내역 -->
          <div class="tab-pane fade" id="pills-contact3" role="tabpanel" aria-labelledby="pills-contact-tab3">
           <div class="describe-content">
            <table class="table table-striped">
             <thead class="table-dark">
             <tr>
              <th scope="col">상품명</th>
              <th scope="col">시작가</th>
              <th scope="col">현재 입찰가</th>
              <th scope="col">즉시 구매가</th>
              <th scope="col">시작일</th>
              <th scope="col">마감일</th>
             </tr>
             </thead>
             <tbody>
             <tr th:each="product : ${failedProducts}">
              <td>
               <a th:href="@{/auction/bid-product/{productId}(productId=${product.id})}" th:text="${product.name}"></a>
              </td>
              <td class="price" th:text="${product.startPrice}"></td>
              <td class="price" th:text="${product.currentPrice}"></td>
              <td class="price" th:text="${product.immediatePrice}"></td>
              <td th:text="${#dates.format(product.startTime, 'yyyy년 M월 d일')}"></td>
              <td th:text="${#dates.format(product.endTime, 'yyyy년 M월 d일')}"></td>
             </tr>
             </tbody>
            </table>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>


      <!-- 1:1 문의 내역 -->
      <div class="tab-pane fade" id="v-pills-pp6" role="tabpanel" aria-labelledby="v-btn-pp6">
       <div class="tab-inner-contentbox mt-0">
        <h5 class="wdget-title" style="padding-bottom: 30px;">1:1 문의 내역</h5>

        <div class="item-describe-area">
         <ul class="nav nav-pills d-flex justify-content-center gap-sm-4 gap-1" id="pills-tab4" role="tablist">
          <li class="nav-item" role="presentation">
           <button class="nav-link active describe-btn" id="pills-home-tab4" data-bs-toggle="pill" data-bs-target="#pills-home4" type="button" role="tab" aria-controls="pills-home4" aria-selected="true">답변 대기</button>
          </li>
          <li class="nav-item" role="presentation">
           <button class="nav-link describe-btn" id="pills-profile-tab4" data-bs-toggle="pill" data-bs-target="#pills-profile4" type="button" role="tab" aria-controls="pills-profile4" aria-selected="false">답변 완료</button>
          </li>
         </ul>

         <!-- 답변 대기 -->
         <div class="tab-content" id="pills-tabContent4">
          <div class="tab-pane fade show active" id="pills-home4" role="tabpanel" aria-labelledby="pills-home-tab4">
           <div class="describe-content">
            <table class="table table-striped">
             <thead class="table-dark">
             <tr>
              <th scope="col">카테고리</th>
              <th scope="col">제목</th>
              <th scope="col">작성 일자</th>
              <th scope="col">상태</th>
             </tr>
             </thead>
             <tbody>
             <tr th:each="inquiry : ${inquiries}" th:if="${inquiry.status.description == '답변대기'}">
              <td th:text="${inquiry.category.description}"></td>
              <td>
               <a th:href="@{/inquiry/{id}(id=${inquiry.id})}" th:text="${inquiry.title}"></a>
              </td>
              <td class="createdAt" th:text="${inquiry.createdAt}"></td>
              <td th:text="${inquiry.status.description}"></td>
             </tr>
             </tbody>
            </table>
           </div>
          </div>

         <!-- 답변 완료 -->
          <div class="tab-pane fade" id="pills-profile4" role="tabpanel" aria-labelledby="pills-profile-tab4">
           <div class="describe-content">
            <div class="describe-content">
             <table class="table table-striped">
              <thead class="table-dark">
              <tr>
               <th scope="col">카테고리</th>
               <th scope="col">제목</th>
               <th scope="col">작성 일자</th>
               <th scope="col">상태</th>
              </tr>
              </thead>
              <tbody>
              <tr th:each="inquiry : ${inquiries}" th:if="${inquiry.status.description == '답변완료'}">
               <td th:text="${inquiry.category.description}"></td>
               <td>
                <a th:href="@{/inquiry/{id}(id=${inquiry.id})}" th:text="${inquiry.title}"></a>
               </td>
               <td class="createdAt" th:text="${inquiry.createdAt}"></td>
               <td th:text="${inquiry.status.description}"></td>
              </tr>
              </tbody>
             </table>
            </div>
           </div>
          </div>

         <div style="text-align: right">
          <a th:href="@{/inquiry/register}" class="qsn-send-btn">문의하기</a>
         </div>
         </div>
       </div>
     </div>
    </div>
   </div>
   </div>
   </div>
  </div>
 </div>

 <script>
  // 금액에 쉼표 추가
  function formatNumber(number) {
   return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  // 경매 등록, 참여 내역 금액에 쉼표 추가
  window.onload = function() {
   document.querySelectorAll('.price').forEach(function(element) {
    element.innerText = formatNumber(element.innerText);
   });
  };

  $(document).ready(function () {
   function loadPage(tabId, pageNum) {
    $.ajax({
     url: `/mypage/data`,
     method: 'GET',
     data: { tab: tabId, page: pageNum },
     success: function (data) {
      $(`#${tabId}-content`).html(data.content);
      $(`#${tabId}-pagination`).html(data.pagination);
     }
    });
   }

   // Initial load
   loadPage('home', 1);

   // Tab change event
   $('.nav-link').on('click', function () {
    const tabId = $(this).data('bs-target').substring(1); // Get the target tab id
    loadPage(tabId, 1);
   });

   // Pagination click event
   $(document).on('click', '.page-link', function (e) {
    e.preventDefault();
    const tabId = $(this).closest('.tab-pane').attr('id');
    const pageNum = $(this).data('page');

    loadPage(tabId, pageNum);
   });
  });
 </script>
</div>

</body>
</html>